<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.soldesk.mapper.BoardMapper">
	
	<sql id="search">
		<if test="type=='writer'">
			where writer like '%' || #{keyword} || '%'
		</if>
		<if test="type=='title'">
			where title like '%' || #{keyword} || '%'
		</if>
		<if test="type=='content'">
			where content like '%' || #{keyword} || '%'
		</if>
	</sql>
	
	<select id="getList" resultType="com.soldesk.entity.Board" parameterType="com.soldesk.entity.Criteria">
	SELECT *
	FROM (
	  SELECT t.*, ROWNUM rnn
	  FROM (
	    SELECT a.*, ROWNUM rn
	    FROM test_board a
	    <include refid="search"/> 
	    ORDER BY boardGroup DESC, boardSequence ASC
	  ) t
	  WHERE ROWNUM <![CDATA[<=]]>  #{pageStart}+#{perPageNum}-1
	)
	WHERE rnn >= #{pageStart}

	</select>
	
	<select id="totalCount" resultType="int" parameterType="com.soldesk.entity.Criteria">
		select count(*) from test_board
		<include refid="search"/>
	</select>
		
</mapper>